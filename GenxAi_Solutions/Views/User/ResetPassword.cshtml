@{
    Layout = null;
    var email = (string)ViewBag.Email ?? "";
    var token = (string)ViewBag.Token ?? "";
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Reset Password</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="p-4">
    <h2>Reset Password</h2>

    <input id="Email" type="hidden" value="@email" />
    <input id="Token" type="hidden" value="@token" />

    <div>
        <input id="NewPassword" type="password" placeholder="New password" class="form-control" />
        <input id="ConfirmPassword" type="password" placeholder="Confirm password" class="form-control mt-2" />
        <button id="btnReset" class="btn btn-success mt-2">Reset Password</button>
        <div id="msg" class="mt-2"></div>
    </div>

    <script>
        $("#btnReset").on("click", function () {
            const newPwd = $("#NewPassword").val();
            const confirmPwd = $("#ConfirmPassword").val();
            if (newPwd !== confirmPwd) {
                $("#msg").text("Passwords do not match.");
                return;
            }

            const data = {
                Email: $("#Email").val(),
                Token: $("#Token").val(),
                NewPassword: newPwd
            };

            $.ajax({
                url: "/api/auth/reset-password",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(data),
                success: function (res) {
                    $("#msg").text(res.message);
                    // Optional: redirect to login after a short delay
                    setTimeout(function(){ window.location.href = "/Home/Index"; }, 1500);
                },
                error: function (err) {
                    const msg = (err.responseJSON && err.responseJSON.message) ? err.responseJSON.message : "Reset failed.";
                    $("#msg").text(msg);
                }
            });
        });
    </script>
</body>
</html>
